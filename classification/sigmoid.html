<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sigmoid Function Demo</title>
    <!-- Include Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
      body,
      html {
        margin: 0;
        padding: 0;
        height: 100%;
        overflow: hidden; /* Prevent vertical scrolling */
      }
      .container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 90vh;
      }
      .slider-container {
        display: flex;
        justify-content: center;
        align-items: center;
        margin: 20px;
      }
      .slider-group {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-right: 20px;
      }
      #plot,
      #plot3d {
        width: 95vw;
        height: 90vh;
      }
      .dropdown-container {
        margin-bottom: 20px;
        margin-top: 20px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="dropdown-container">
        <label for="plot-selector">Choose a sigmoid function:</label>
        <select id="plot-selector" onchange="switchPlot()">
          <option value="2d">sigmoid(θx + θ₀)</option>
          <option value="3d">sigmoid(θ₁x₁ + θ₂x₂ + θ₀)</option>
        </select>
      </div>
      <div id="plot"></div>
      <div id="plot3d" style="display: none"></div>
      <div id="sliders-2d" class="slider-container">
        <div class="slider-group">
          <label for="theta">θ:</label>
          <input
            type="range"
            id="theta"
            min="-10"
            max="10"
            value="-3"
            step="0.1"
            oninput="updatePlot2D()"
          />
          <span id="theta_value">-3</span>
        </div>
        <div class="slider-group">
          <label for="theta_0">θ₀:</label>
          <input
            type="range"
            id="theta_0"
            min="-5"
            max="5"
            value="0"
            step="0.1"
            oninput="updatePlot2D()"
          />
          <span id="theta_0_value">0</span>
        </div>
      </div>
      <div id="sliders-3d" class="slider-container" style="display: none">
        <div class="slider-group">
          <label for="theta_1">θ₁:</label>
          <input
            type="range"
            id="theta_1"
            min="-10"
            max="10"
            value="-3"
            step="0.1"
            oninput="updatePlot3D()"
          />
          <span id="theta_1_value">-3</span>
        </div>
        <div class="slider-group">
          <label for="theta_2">θ₂:</label>
          <input
            type="range"
            id="theta_2"
            min="-10"
            max="10"
            value="1"
            step="0.1"
            oninput="updatePlot3D()"
          />
          <span id="theta_2_value">1</span>
        </div>
        <div class="slider-group">
          <label for="theta_0_3d">θ₀:</label>
          <input
            type="range"
            id="theta_0_3d"
            min="-10"
            max="10"
            value="0"
            step="0.1"
            oninput="updatePlot3D()"
          />
          <span id="theta_0_3d_value">0</span>
        </div>
        <button id="toggleZ0" onclick="toggleZ0Surface()" style="display: none">
          Toggle σ = 0.5 Plane
        </button>
      </div>
    </div>

    <script>
      let z0SurfaceVisible = false;
      const halfLine = {
        type: 'line', xref: 'paper', x0: 0, x1: 1, y0: 0.5, y1: 0.5,
        line: { color: 'rgba(140,140,140,.5)', width: 1.5, dash: 'dash' },
      };
      const surfaceColorscale = [
        [0, '#7eafd4'], [0.4, '#c8dce8'],
        [0.5, '#f0f0f0'],
        [0.6, '#e8c8c8'], [1, '#d47e7e'],
      ];
      const fixedCameraSettings = {
        eye: { x: 1.5, y: 1.5, z: 1.5 },
        center: { x: 0, y: 0, z: 0 },
        up: { x: 0, y: 0, z: 1 },
      };

      // Sigmoid function for 2D
      function sigmoid(x, theta, theta_0) {
        return 1 / (1 + Math.exp(-(theta * x + theta_0)));
      }

      // Sigmoid function for 3D
      function sigmoid3D(x1, x2, theta_1, theta_2, theta_0) {
        return 1 / (1 + Math.exp(-(theta_1 * x1 + theta_2 * x2 + theta_0)));
      }

      // Generate data points for 2D sigmoid function
      function generateSigmoidData2D(theta, theta_0) {
        let x = [];
        let y = [];
        for (let i = -10; i <= 10; i += 0.02) {
          x.push(i);
          y.push(sigmoid(i, theta, theta_0));
        }
        return { x: x, y: y };
      }

      // Generate data points for 3D sigmoid function, with x1 and x2 limited to [-2, 2]
      function generateSigmoidData3D(theta_1, theta_2, theta_0) {
        let gridX1 = [];
        let gridX2 = [];
        let z = [];

        for (let i = -2; i <= 2; i += 0.1) {
          gridX2.push(i);
        }
        for (let i = -2; i <= 2; i += 0.1) {
          gridX1.push(i);
          let zRow = [];
          for (let j = 0; j < gridX2.length; j++) {
            zRow.push(sigmoid3D(gridX2[j], i, theta_1, theta_2, theta_0));
          }
          z.push(zRow);
        }
        return { x1: gridX1, x2: gridX2, z: z };
      }

      // Plot 2D sigmoid with axis labels
      function createPlot2D() {
        var data = generateSigmoidData2D(-3, 0); // Initial θ = -3, θ₀ = 0
        var layout = {
          title: "Sigmoid Function: sigmoid(θx + θ₀)",
          xaxis: { title: "x", range: [-10, 10] },
          yaxis: { title: "sigmoid(θx + θ₀)", range: [0, 1] },
          margin: { l: 50, r: 10, t: 50, b: 50 },
          shapes: [halfLine],
        };

        Plotly.newPlot(
          "plot",
          [{ x: data.x, y: data.y, mode: "lines", line: { color: '#3a7ebf' } }],
          layout
        );
      }

      // Plot 3D sigmoid with axis labels and σ=0.5 surface
      function createPlot3D() {
        var data = generateSigmoidData3D(-3, 1, 0); // Initial θ₁ = -3, θ₂ = 1, θ₀ = 0
        var z0data = generateZ05SurfaceData(); // Generate the z=0.5 surface
        var layout = {
          title: "Sigmoid Function: sigmoid(θ₁x₁ + θ₂x₂ + θ₀)",
          scene: {
            xaxis: { title: "x₁", range: [-2, 2] },
            yaxis: { title: "x₂", range: [-2, 2] },
            zaxis: { title: "sigmoid(θ₁x₁ + θ₂x₂ + θ₀)", range: [0, 1] },
            aspectmode: "cube", // Ensures all axes are on equal scale
            camera: fixedCameraSettings, // Fix the camera view
          },
          margin: { l: 0, r: 0, t: 50, b: 0 },
        };

        Plotly.newPlot(
          "plot3d",
          [
            {
              x: data.x1,
              y: data.x2,
              z: data.z,
              type: "surface",
              colorscale: surfaceColorscale,
              cmin: 0, cmax: 1,
              showscale: false,
            },
            z0data,
          ],
          layout
        );
      }

      // Generate σ=0.5 surface data (flat plane at z=0.5)
      function generateZ05SurfaceData() {
        let grid = [];
        let z = [];
        for (let i = -2; i <= 2; i += 0.1) {
          grid.push(i);
          let zRow = [];
          for (let j = -2; j <= 2; j += 0.1) {
            zRow.push(0.5);
          }
          z.push(zRow);
        }
        return {
          x: grid,
          y: grid,
          z: z,
          type: "surface",
          colorscale: [[0, 'rgba(140,140,140,.3)'], [1, 'rgba(140,140,140,.3)']],
          showscale: false,
          opacity: 0.4,
          hoverinfo: 'skip',
          visible: z0SurfaceVisible,
        };
      }

      // Toggle z=0.5 surface visibility
      function toggleZ0Surface() {
        z0SurfaceVisible = !z0SurfaceVisible;
        Plotly.restyle("plot3d", { visible: z0SurfaceVisible }, [1]); // Toggle the visibility of the z=0.5 surface (index 1)
      }

      // Update 2D plot when sliders change
      function updatePlot2D() {
        var theta = parseFloat(document.getElementById("theta").value);
        var theta_0 = parseFloat(document.getElementById("theta_0").value);

        document.getElementById("theta_value").textContent = theta.toFixed(1);
        document.getElementById("theta_0_value").textContent =
          theta_0.toFixed(1);

        var data = generateSigmoidData2D(theta, theta_0);
        var layout = {
          title: "Sigmoid Function: sigmoid(θx + θ₀)",
          xaxis: { title: "x", range: [-10, 10] },
          yaxis: { title: "sigmoid(θx + θ₀)", range: [0, 1] },
          margin: { l: 50, r: 10, t: 50, b: 50 },
          shapes: [halfLine],
        };

        Plotly.react("plot", [{ x: data.x, y: data.y, mode: "lines", line: { color: '#3a7ebf' } }], layout);
      }

      // Update 3D plot when sliders change
      function updatePlot3D() {
        var theta_1 = parseFloat(document.getElementById("theta_1").value);
        var theta_2 = parseFloat(document.getElementById("theta_2").value);
        var theta_0 = parseFloat(document.getElementById("theta_0_3d").value);

        document.getElementById("theta_1_value").textContent =
          theta_1.toFixed(1);
        document.getElementById("theta_2_value").textContent =
          theta_2.toFixed(1);
        document.getElementById("theta_0_3d_value").textContent =
          theta_0.toFixed(1);

        var data = generateSigmoidData3D(theta_1, theta_2, theta_0);
        var z0data = generateZ05SurfaceData();

        // Preserve current camera angle if user has rotated the plot
        var currentCamera = fixedCameraSettings;
        var plotEl = document.getElementById("plot3d");
        if (plotEl._fullLayout && plotEl._fullLayout.scene) {
          currentCamera = plotEl._fullLayout.scene._scene.getCamera();
        }

        var layout = {
          title: "Sigmoid Function: sigmoid(θ₁x₁ + θ₂x₂ + θ₀)",
          scene: {
            xaxis: { title: "x₁", range: [-2, 2] },
            yaxis: { title: "x₂", range: [-2, 2] },
            zaxis: { title: "sigmoid(θ₁x₁ + θ₂x₂ + θ₀)", range: [0, 1] },
            aspectmode: "cube",
            camera: currentCamera,
          },
          margin: { l: 0, r: 0, t: 50, b: 0 },
        };

        Plotly.react(
          "plot3d",
          [
            {
              x: data.x1,
              y: data.x2,
              z: data.z,
              type: "surface",
              colorscale: surfaceColorscale,
              cmin: 0, cmax: 1,
              showscale: false,
            },
            z0data,
          ],
          layout
        );
      }

      // Switch between 2D and 3D plots
      function switchPlot() {
        var plotSelector = document.getElementById("plot-selector").value;
        if (plotSelector === "2d") {
          document.getElementById("plot").style.display = "block";
          document.getElementById("sliders-2d").style.display = "flex";
          document.getElementById("plot3d").style.display = "none";
          document.getElementById("sliders-3d").style.display = "none";
          document.getElementById("toggleZ0").style.display = "none";
          createPlot2D();
        } else {
          document.getElementById("plot").style.display = "none";
          document.getElementById("sliders-2d").style.display = "none";
          document.getElementById("plot3d").style.display = "block";
          document.getElementById("sliders-3d").style.display = "flex";
          document.getElementById("toggleZ0").style.display = "block";
          createPlot3D();
        }
      }

      // Resize the plots when the window is resized
      window.onresize = function () {
        Plotly.Plots.resize(document.getElementById("plot"));
        Plotly.Plots.resize(document.getElementById("plot3d"));
      };

      // Initialize the 2D plot by default
      window.onload = function () {
        switchPlot();
      };
    </script>
    <div style="position:fixed;bottom:0;width:100%;text-align:center;padding:6px 0;font-size:13px;color:#888;background:#fafafa;">
      <a href="https://github.com/shensquared/demos" target="_blank" style="color:#007bff;text-decoration:none;">Source</a>
      <span style="margin:0 6px;">|</span>
      <a href="https://github.com/shensquared/demos/issues" target="_blank" style="color:#007bff;text-decoration:none;">Report a Bug</a>
    </div>
  </body>
</html>
