<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Linear Separator with MSE</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
      body,
      html {
        margin: 0;
        padding: 0;
        height: 100%;
        overflow: hidden;
      }
      .plots-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        height: 80vh;
      }
      #plot, #plot3D {
        width: 50%;
        height: 100%;
      }
      .slider-container {
        display: flex;
        justify-content: space-around;
        align-items: center;
        height: 15vh;
      }
      .slider-group {
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      .footer {
        display: flex;
        justify-content: center;
        align-items: center;
        width: 100%;
        background-color: #f8f9fa;
        color: #6c757d;
        text-align: center;
        height: 5vh;
      }
      .footer a {
        color: #007bff;
        text-decoration: none;
      }
      .footer a:hover {
        text-decoration: underline;
      }
    </style>
  </head>
  <body>
    <div class="plots-container">
      <div id="plot"></div>
      <div id="plot3D"></div>
    </div>
    <div class="slider-container">
      <div class="slider-group">
        <label for="theta_1">θ₁:</label>
        <input type="range" id="theta_1" min="-2" max="2" value="0.5" step="0.1" oninput="updatePlot()">
        <span id="theta_1_value">0.5</span>
      </div>
      <div class="slider-group">
        <label for="theta_2">θ₂:</label>
        <input type="range" id="theta_2" min="-2" max="2" value="0.5" step="0.1" oninput="updatePlot()">
        <span id="theta_2_value">0.5</span>
      </div>
    </div>
    <div class="footer">
      Built with ❤️ by&nbsp;<a href="https://shenshen.mit.edu" target="_blank">Shen²</a>
      <span>&nbsp;|&nbsp;</span>
      <a href="https://github.com/shensquared/demos" target="_blank">Report a Bug</a>
    </div>

    <script>
      var customCameraSettings = {
        eye: { x: 0, y: -1, z: 2 },
        up: { x: 0, y: 0, z: 1 },
        center: { x: 0, y: 0, z: 0 },
      };

      var layout = {
        title:
          "View of the feature space (x₁ and x₂)<br>z = θ₁x₁ + θ₂x₂",
        scene: {
          xaxis: { title: "x₁", range: [-2, 2], tickmode: "linear", dtick: 1 },
          yaxis: { title: "x₂", range: [-2, 2], tickmode: "linear", dtick: 1 },
          zaxis: {
            title: "z",
            range: [-6, 6],
            tickvals: [-5, -3, -1, 0, 1, 3, 5]
          },
          aspectmode: "manual",
          aspectratio: { x: 1, y: 1, z: 1 },
          camera: customCameraSettings,
        },
        showlegend: false,
      };

      var customColorscale = "Viridis";

      function generateSurfaceData(theta_1, theta_2) {
        var a = [], b = [], z = [];
        for (var i = -2; i <= 2; i += 0.01) {
          a.push(i);
        }
        for (var j = -2; j <= 2; j += 0.01) {
          b.push(j);
        }
        for (var i = 0; i < a.length; i++) {
          var zRow = [];
          for (var j = 0; j < b.length; j++) {
            zRow.push(theta_2 * a[i] + theta_1 * b[j]);
          }
          z.push(zRow);
        }
        return {
          x: a,
          y: b,
          z: z,
          type: "surface",
          showscale: false,
          opacity: 0.7,
          colorscale: customColorscale,
          surfacecolor: z,
        };
      }

      function generateScatterTraces() {
        return [
          {
            x: [1],
            y: [2],
            z: [2.5],
            mode: "markers",
            type: "scatter3d",
            name: "Data Point 1",
            marker: { size: 8, color: "black" },
          },
          {
            x: [2],
            y: [1],
            z: [-1.8],
            mode: "markers",
            type: "scatter3d",
            name: "Data Point 2",
            marker: { size: 8, color: "black" },
          }
        ];
      }

      function updatePlot() {
        var theta_1 = parseFloat(document.getElementById("theta_1").value);
        var theta_2 = parseFloat(document.getElementById("theta_2").value);
        document.getElementById("theta_1_value").textContent = theta_1.toFixed(1);
        document.getElementById("theta_2_value").textContent = theta_2.toFixed(1);

        var surfaceTrace = generateSurfaceData(theta_1, theta_2);
        var scatter3dTraces = generateScatterTraces();

        Plotly.react("plot", [surfaceTrace].concat(scatter3dTraces), layout);
        updateRightPlotMarker();
      }

      function updateRightPlotMarker() {
        let currentTheta1 = parseFloat(document.getElementById("theta_1").value);
        let currentTheta2 = parseFloat(document.getElementById("theta_2").value);

        let pred1 = currentTheta1 * 1 + currentTheta2 * 2;
        let pred2 = currentTheta1 * 2 + currentTheta2 * 1;
        let currentMSE = ((pred1 - 2.5) ** 2 + (pred2 - (-1.8)) ** 2) / 2;

        Plotly.restyle('plot3D', {
          x: [[currentTheta1]],
          y: [[currentTheta2]],
          z: [[currentMSE]]
        }, [1]);
      }

      // --- FIXED MSE surface construction ---
      (function () {
        const theta1_values = Array.from({ length: 41 }, (_, i) => -2 + 0.1 * i);
        const theta2_values = Array.from({ length: 41 }, (_, i) => -2 + 0.1 * i);
        let Z = [];
        for (let yi = 0; yi < theta2_values.length; yi++) {
          const t2 = theta2_values[yi];
          let row = [];
          for (let xi = 0; xi < theta1_values.length; xi++) {
            const t1 = theta1_values[xi];
            const pred1 = t1 * 1 + t2 * 2;
            const pred2 = t1 * 2 + t2 * 1;
            const mse = ((pred1 - 2.5) ** 2 + (pred2 - (-1.8)) ** 2) / 2;
            row.push(mse);
          }
          Z.push(row);
        }

        const surfaceTrace = {
          z: Z,
          x: theta1_values,
          y: theta2_values,
          type: 'surface',
          colorscale: [[0, 'blue'], [1, 'red']],
          contours: {
            z: { show: true, usecolormap: true, project: { z: true } }
          },
          showscale: false,
          name: 'MSE'
        };

        const initialTheta1 = parseFloat(document.getElementById("theta_1").value);
        const initialTheta2 = parseFloat(document.getElementById("theta_2").value);
        const initialPred1 = initialTheta1 * 1 + initialTheta2 * 2;
        const initialPred2 = initialTheta1 * 2 + initialTheta2 * 1;
        const initialMSE = ((initialPred1 - 2.5) ** 2 + (initialPred2 - (-1.8)) ** 2) / 2;

        const markerTrace = {
          x: [initialTheta1],
          y: [initialTheta2],
          z: [initialMSE],
          mode: 'markers',
          type: 'scatter3d',
          marker: { size: 6, color: 'gold' },
          name: 'Current MSE'
        };

        const data3D = [surfaceTrace, markerTrace];
        const layout3D = {
          title: 'MSE J(θ)',
          scene: {
            xaxis: { title: 'θ₁' },
            yaxis: { title: 'θ₂' },
            zaxis: { title: 'MSE' },
            camera: { eye: { x: 1.5, y: -1.5, z: 1.5 } }
          },
          autosize: true
        };

        Plotly.newPlot('plot3D', data3D, layout3D);
      })();

      updatePlot();
    </script>
  </body>
</html>