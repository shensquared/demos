<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Linear Separator</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
      * { box-sizing: border-box; margin: 0; padding: 0; }

      html, body {
        width: 100%; height: 100%;
        font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        background: #fafafa; color: #333;
      }

      .container { display: flex; height: 100%; }

      .sidebar {
        width: 240px; min-width: 240px;
        padding: 24px 20px;
        background: #fff;
        border-right: 1px solid #e0e0e0;
        display: flex; flex-direction: column;
        gap: 18px;
        overflow-y: auto;
      }

      .sidebar h1 { font-size: 20px; font-weight: 600; color: #222; }
      .sidebar .eq { font-size: 15px; color: #888; margin-top: 2px; }

      .control-group label {
        display: block; font-size: 15px; font-weight: 500;
        color: #555; margin-bottom: 6px;
      }

      .control-group .val {
        font-family: "SF Mono", Menlo, monospace;
        font-size: 15px; color: #222; float: right;
      }

      input[type="range"] {
        -webkit-appearance: none; width: 100%; height: 6px;
        border-radius: 3px; background: #e0e0e0; outline: none;
      }

      input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none; width: 16px; height: 16px;
        border-radius: 50%; background: #555; cursor: pointer;
        border: 2px solid #fff; box-shadow: 0 1px 3px rgba(0,0,0,.2);
      }

      .scale-toggle {
        display: flex; gap: 0;
        border: 1px solid #ddd; border-radius: 4px;
        overflow: hidden;
      }

      .scale-toggle button {
        flex: 1; padding: 8px 0;
        font-size: 14px; font-family: inherit;
        border: none; background: #fff; color: #777;
        cursor: pointer; transition: all .15s;
      }

      .scale-toggle button.active { background: #555; color: #fff; }

      .scale-toggle button:not(:last-child) { border-right: 1px solid #ddd; }

      .toggle-btn {
        width: 100%; padding: 8px 0;
        font-size: 14px; font-family: inherit;
        border: 1px solid #ddd; border-radius: 4px;
        background: #fff; color: #777; cursor: pointer;
        transition: all .15s;
      }

      .toggle-btn.active { background: #555; color: #fff; border-color: #555; }

      .legend { font-size: 14px; color: #666; line-height: 2.2; }

      .legend .dot {
        display: inline-block; width: 9px; height: 9px;
        border-radius: 50%; margin-right: 6px; vertical-align: middle;
      }

      .legend .arrow {
        display: inline-block; color: #2ecc71;
        font-size: 18px; margin-right: 4px; vertical-align: middle;
      }

      .legend .line {
        display: inline-block; width: 16px; height: 2px;
        margin-right: 6px; vertical-align: middle;
      }

      .info {
        margin-top: auto; padding-top: 14px;
        border-top: 1px solid #e0e0e0;
        font-size: 14px; color: #aaa; line-height: 1.8;
      }

      .info span {
        font-family: "SF Mono", Menlo, monospace; font-size: 14px; color: #666;
      }

      .plots { flex: 1; display: flex; height: 100%; min-width: 0; }
      .plots > div { flex: 1; height: 100%; min-width: 0; }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="sidebar">
        <div>
          <h1>Linear Separator</h1>
          <div class="eq">z = θ₁x₁ + θ₂x₂ + θ₀</div>
        </div>

        <div class="control-group">
          <label>θ₁ <span class="val" id="t1Val">0.5</span></label>
          <input type="range" id="t1" min="-2" max="2" value="0.5" step="0.1" />
        </div>

        <div class="control-group">
          <label>θ₂ <span class="val" id="t2Val">0.5</span></label>
          <input type="range" id="t2" min="-2" max="2" value="0.5" step="0.1" />
        </div>

        <div class="control-group">
          <label>θ₀ <span class="val" id="t0Val">0.0</span></label>
          <input type="range" id="t0" min="-2" max="2" value="0" step="0.1" />
        </div>

        <div class="control-group">
          <label>Scale θ</label>
          <div class="scale-toggle">
            <button data-s="-2">−2×</button>
            <button data-s="-1">−1×</button>
            <button data-s="1" class="active">1×</button>
            <button data-s="2">2×</button>
          </div>
        </div>

        <button class="toggle-btn" id="btnZ0">Show z = 0 plane</button>

        <div class="legend">
          <div><span class="dot" style="background:#e74c3c"></span>Positive (+1)</div>
          <div><span class="dot" style="background:#3a7ebf"></span>Negative (0)</div>
          <div><span class="line" style="background:#333"></span>Separator</div>
          <div><span class="arrow">→</span>Normal vector (θ)</div>
        </div>

        <div class="info">
          Errors: <span id="infoErr">–</span> / <span id="infoN">10</span><br>
          Accuracy: <span id="infoAcc">–</span>
        </div>
      </div>

      <div class="plots">
        <div id="plot2d"></div>
        <div id="plot3d"></div>
      </div>
    </div>

    <script>
      const pts = [
        { x1: -0.8, x2:  1.2, y:  1 },
        { x1: -0.3, x2:  0.9, y:  1 },
        { x1:  0.5, x2:  1.4, y:  1 },
        { x1: -1.0, x2:  0.4, y:  1 },
        { x1:  0.2, x2:  0.7, y:  1 },
        { x1:  1.0, x2: -0.8, y:  0 },
        { x1:  0.5, x2: -1.1, y:  0 },
        { x1: -0.4, x2: -1.2, y:  0 },
        { x1:  1.3, x2: -0.3, y:  0 },
        { x1: -0.1, x2: -0.6, y:  0 },
      ];

      const posCol = '#e74c3c', negCol = '#3a7ebf';
      const cfg = { displayModeBar: false, responsive: true };

      const N = 80;
      const gx = Array.from({ length: N }, (_, i) => -2 + 4 * i / (N - 1));
      const gy = [...gx];

      let showZ0 = false;
      let scale = 1;
      const t1El = document.getElementById('t1');
      const t2El = document.getElementById('t2');
      const t0El = document.getElementById('t0');

      function sc(t1, t2, t0, x1, x2) { return t1 * x1 + t2 * x2 + t0; }

      function update() {
        const t1 = parseFloat(t1El.value) * scale;
        const t2 = parseFloat(t2El.value) * scale;
        const t0 = parseFloat(t0El.value) * scale;

        document.getElementById('t1Val').textContent = t1.toFixed(1);
        document.getElementById('t2Val').textContent = t2.toFixed(1);
        document.getElementById('t0Val').textContent = t0.toFixed(1);

        let errs = 0;
        pts.forEach(p => {
          const s = sc(t1, t2, t0, p.x1, p.x2);
          if ((p.y === 1 && s <= 0) || (p.y === 0 && s > 0)) errs++;
        });
        document.getElementById('infoErr').textContent = errs;
        document.getElementById('infoN').textContent = pts.length;
        document.getElementById('infoAcc').textContent =
          ((pts.length - errs) / pts.length * 100).toFixed(0) + '%';

        draw3D(t1, t2, t0);
        draw2D(t1, t2, t0);
      }

      function boundaryPts(t1, t2, t0) {
        let bx = [], by = [];
        if (Math.abs(t2) > 0.01) {
          bx = Array.from({ length: 100 }, (_, i) => -2 + 4 * i / 99);
          by = bx.map(x => (-t0 - t1 * x) / t2);
        } else if (Math.abs(t1) > 0.01) {
          by = Array.from({ length: 100 }, (_, i) => -2 + 4 * i / 99);
          bx = by.map(() => -t0 / t1);
        }
        return { bx, by };
      }

      function draw3D(t1, t2, t0) {
        const zGrid = gy.map(y => gx.map(x => sc(t1, t2, t0, x, y)));

        const surface = {
          x: gx, y: gy, z: zGrid,
          type: 'surface',
          colorscale: [
            [0, '#7eafd4'], [0.4, '#c8dce8'],
            [0.5, '#f0f0f0'],
            [0.6, '#e8c8c8'], [1, '#d47e7e'],
          ],
          cmin: -6, cmax: 6,
          showscale: false, opacity: 0.75, hoverinfo: 'skip',
        };

        const { bx, by } = boundaryPts(t1, t2, t0);
        const boundary = {
          x: bx, y: by, z: bx.map(() => 0),
          type: 'scatter3d', mode: 'lines',
          line: { color: '#333', width: 5 },
          hoverinfo: 'skip',
        };

        const z0plane = {
          x: [-2, 2], y: [-2, 2], z: [[0, 0], [0, 0]],
          type: 'surface',
          colorscale: [[0, 'rgba(140,140,140,.3)'], [1, 'rgba(140,140,140,.3)']],
          showscale: false, opacity: 0.4,
          visible: showZ0, hoverinfo: 'skip',
        };

        const pos = pts.filter(p => p.y === 1);
        const neg = pts.filter(p => p.y === -1);

        const posT = {
          x: pos.map(p => p.x1), y: pos.map(p => p.x2), z: pos.map(() => 0),
          type: 'scatter3d', mode: 'markers',
          marker: { size: 4, color: posCol, line: { color: '#fff', width: 0.5 } },
          hovertemplate: '(%{x:.1f}, %{y:.1f})<extra>+1</extra>',
        };
        const negT = {
          x: neg.map(p => p.x1), y: neg.map(p => p.x2), z: neg.map(() => 0),
          type: 'scatter3d', mode: 'markers',
          marker: { size: 4, color: negCol, line: { color: '#fff', width: 0.5 } },
          hovertemplate: '(%{x:.1f}, %{y:.1f})<extra>0</extra>',
        };

        const layout = {
          scene: {
            xaxis: { title: 'x₁', range: [-2, 2], tickmode: 'linear', dtick: 1, gridcolor: '#e0e0e0' },
            yaxis: { title: 'x₂', range: [-2, 2], tickmode: 'linear', dtick: 1, gridcolor: '#e0e0e0' },
            zaxis: { title: 'z', range: [-6, 6], gridcolor: '#e0e0e0' },
            aspectmode: 'manual', aspectratio: { x: 1, y: 1, z: 1 },
            camera: { eye: { x: 0, y: -2, z: 1.2 }, up: { x: 0, y: 0, z: 1 } },
            bgcolor: '#fafafa',
          },
          margin: { l: 0, r: 0, t: 0, b: 0 },
          paper_bgcolor: '#fafafa',
          showlegend: false,
        };

        Plotly.react('plot3d', [surface, boundary, z0plane, posT, negT], layout, cfg);
      }

      function draw2D(t1, t2, t0) {
        const N2 = 150;
        const gx2 = Array.from({ length: N2 }, (_, i) => -2 + 4 * i / (N2 - 1));
        const gy2 = [...gx2];
        const signGrid = gy2.map(y => gx2.map(x => sc(t1, t2, t0, x, y) > 0 ? 1 : 0));

        const region = {
          x: gx2, y: gy2, z: signGrid,
          type: 'heatmap',
          colorscale: [[0, 'rgba(58,126,191,.1)'], [1, 'rgba(231,76,60,.1)']],
          showscale: false, hoverinfo: 'skip',
        };

        const { bx, by } = boundaryPts(t1, t2, t0);
        const sep = {
          x: bx, y: by,
          type: 'scatter', mode: 'lines',
          line: { color: '#333', width: 2 },
          hoverinfo: 'skip',
        };

        const pos = pts.filter(p => p.y === 1);
        const neg = pts.filter(p => p.y === -1);

        const posT = {
          x: pos.map(p => p.x1), y: pos.map(p => p.x2),
          type: 'scatter', mode: 'markers',
          marker: { size: 9, color: posCol, line: { color: '#fff', width: 1.5 } },
          hovertemplate: '(%{x:.1f}, %{y:.1f})<extra>+1</extra>',
        };
        const negT = {
          x: neg.map(p => p.x1), y: neg.map(p => p.x2),
          type: 'scatter', mode: 'markers',
          marker: { size: 9, color: negCol, line: { color: '#fff', width: 1.5 } },
          hovertemplate: '(%{x:.1f}, %{y:.1f})<extra>0</extra>',
        };

        const hasVec = Math.abs(t1) > 0.01 || Math.abs(t2) > 0.01;

        const layout = {
          xaxis: {
            title: { text: 'x₁', font: { size: 13 } },
            range: [-2, 2], zeroline: false, gridcolor: '#eee',
          },
          yaxis: {
            title: { text: 'x₂', font: { size: 13 } },
            range: [-2, 2], zeroline: false, gridcolor: '#eee',
            scaleanchor: 'x',
          },
          margin: { l: 48, r: 16, t: 16, b: 44 },
          paper_bgcolor: '#fafafa', plot_bgcolor: '#fafafa',
          showlegend: false, hovermode: 'closest',
          annotations: hasVec ? [{
            x: t1, y: t2,
            ax: 0, ay: 0,
            xref: 'x', yref: 'y', axref: 'x', ayref: 'y',
            showarrow: true,
            arrowhead: 2, arrowsize: 1.5, arrowwidth: 2,
            arrowcolor: '#2ecc71', text: '',
          }] : [],
        };

        Plotly.react('plot2d', [region, sep, posT, negT], layout, cfg);
      }

      t1El.addEventListener('input', update);
      t2El.addEventListener('input', update);
      t0El.addEventListener('input', update);

      document.querySelectorAll('.scale-toggle button').forEach(btn => {
        btn.addEventListener('click', function () {
          scale = parseFloat(this.dataset.s);
          document.querySelectorAll('.scale-toggle button').forEach(b => b.classList.remove('active'));
          this.classList.add('active');
          update();
        });
      });

      document.getElementById('btnZ0').addEventListener('click', function () {
        showZ0 = !showZ0;
        this.classList.toggle('active', showZ0);
        this.textContent = showZ0 ? 'Hide z = 0 plane' : 'Show z = 0 plane';
        update();
      });

      update();

      window.addEventListener('resize', () => {
        Plotly.Plots.resize(document.getElementById('plot3d'));
        Plotly.Plots.resize(document.getElementById('plot2d'));
      });
    </script>
  </body>
</html>
