<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Two-Layer Network Demo</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
      body,
      html {
        margin: 0;
        padding: 0;
        height: 100%;
        overflow: hidden;
        font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        background-color: #fafafa;
        color: #333;
      }
      .top-bar {
        display: grid;
        grid-template-columns: 50% 50%;
        width: 100vw;
        background-color: #f0f0f0;
        border-bottom: 1px solid #ddd;
        font-size: 14px;
      }
      .top-bar-left, .top-bar-right {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 6px 10px;
        font-weight: 600;
        color: #555;
        letter-spacing: 0.3px;
        gap: 8px;
      }
      .top-bar-left {
        border-right: 1px solid #ddd;
      }
      .top-bar select {
        font-size: 14px;
        font-weight: 400;
        padding: 2px 8px;
        border-radius: 4px;
        border: 1px solid #bbb;
      }
      .main-container {
        display: grid;
        grid-template-columns: 50% 50%;
        grid-template-rows: 1fr 1fr;
        width: 100vw;
        height: calc(100vh - 60px);
      }
      .grid-item {
        padding: 4px 10px;
      }
      .left-column {
        grid-column: 1;
      }
      #cell-1 {
        grid-row: 1;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
      }
      #cell-2 {
        grid-row: 2;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
      }
      .plot-container {
        flex-grow: 1;
        width: 100%;
        height: 100%;
      }
      .slider-container {
        display: flex;
        justify-content: space-around;
        padding: 4px 10px;
      }
      .slider-group {
        display: flex;
        flex-direction: column;
        align-items: center;
        font-size: 14px;
      }
      .slider-group label {
        font-weight: 500;
        color: #555;
        margin-bottom: 2px;
      }
      .slider-group span {
        font-size: 13px;
        color: #888;
        margin-top: 1px;
      }
      input[type="range"] {
        accent-color: #1565c0;
      }
      .footer {
        text-align: center;
        padding: 4px 0;
        font-size: 12px;
        color: #999;
      }
      .footer a {
        color: #1565c0;
        text-decoration: none;
      }
      .footer a:hover {
        text-decoration: underline;
      }
      .right-column {
        grid-column: 2;
        grid-row: 1 / span 2;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }
    </style>
  </head>
  <body>
    <div class="top-bar">
      <div class="top-bar-left">
        Layer 1: two neurons
        <select id="activationSelect" onchange="changeActivation()">
          <option value="sigmoid" selected>Sigmoid</option>
          <option value="relu">ReLU</option>
        </select>
      </div>
      <div class="top-bar-right">Layer 2 preactivation</div>
    </div>

    <div class="main-container">

      <!-- Left column, first row: First activation function plot and sliders -->
      <div id="cell-1" class="grid-item left-column">
        <div class="plot-container" id="plot3d"></div>
        <div class="slider-container">
          <div class="slider-group">
            <label>w&#x2081;&#x2081;</label>
            <input type="range" id="theta_11" min="-5" max="5" value="5" step="0.1" oninput="updatez1()" />
            <span id="theta_11_value">5</span>
          </div>
          <div class="slider-group">
            <label>w&#x2081;&#x2082;</label>
            <input type="range" id="theta_12" min="-5" max="5" value="-5" step="0.1" oninput="updatez1()" />
            <span id="theta_12_value">-5</span>
          </div>
          <div class="slider-group">
            <label>w&#x2081;&#x2080;</label>
            <input type="range" id="theta_10" min="-5" max="5" value="1" step="0.1" oninput="updatez1()" />
            <span id="theta_10_value">1</span>
          </div>
        </div>
      </div>

      <!-- Left column, second row: Second activation function plot and sliders -->
      <div id="cell-2" class="grid-item left-column">
        <div class="plot-container" id="plot3d_2"></div>
        <div class="slider-container">
          <div class="slider-group">
            <label>w&#x2082;&#x2081;</label>
            <input type="range" id="theta_21" min="-5" max="5" value="-5" step="0.1" oninput="updatez2()" />
            <span id="theta_21_value">-5</span>
          </div>
          <div class="slider-group">
            <label>w&#x2082;&#x2082;</label>
            <input type="range" id="theta_22" min="-5" max="5" value="5" step="0.1" oninput="updatez2()" />
            <span id="theta_22_value">5</span>
          </div>
          <div class="slider-group">
            <label>w&#x2082;&#x2080;</label>
            <input type="range" id="theta_20" min="-5" max="5" value="1" step="0.1" oninput="updatez2()" />
            <span id="theta_20_value">1</span>
          </div>
        </div>
      </div>

      <!-- Right column, spanning both rows: Weighted output -->
      <div class="grid-item right-column">
        <div class="plot-container" id="plot_weighted"></div>
        <div class="slider-container">
          <div class="slider-group">
            <label>w&#x2081;</label>
            <input type="range" id="w1" min="-5" max="5" value="1" step="0.1" oninput="update_layer2()" />
            <span id="w1_value">1</span>
          </div>
          <div class="slider-group">
            <label>w&#x2082;</label>
            <input type="range" id="w2" min="-5" max="5" value="1" step="0.1" oninput="update_layer2()" />
            <span id="w2_value">1</span>
          </div>
          <div class="slider-group">
            <label>w&#x2080;</label>
            <input type="range" id="w0" min="-5" max="5" value="-1" step="0.1" oninput="update_layer2()" />
            <span id="w0_value">-1</span>
          </div>
        </div>
      </div>
    </div>

    <div class="footer">
      <a href="https://github.com/shensquared/demos" target="_blank">Source</a>
      <span>&nbsp;|&nbsp;</span>
      <a href="https://github.com/shensquared/demos/issues" target="_blank">Report a Bug</a>
    </div>

    <script>
      // Lec04 colorscale: blue -> white -> red
      var demoColorscale = [
        [0.0, '#7eafd4'],
        [0.4, '#c8dce8'],
        [0.5, '#f0f0f0'],
        [0.6, '#e8c8c8'],
        [1.0, '#d47e7e']
      ];

      var activationFunction = "sigmoid";

      function changeActivation() {
        activationFunction = document.getElementById("activationSelect").value;
        updatez1();
        updatez2();
      }

      const fixedCameraSettings = {
        eye: { x: 1.5, y: 1.5, z: 1.5 },
        center: { x: 0, y: 0, z: 0 },
        up: { x: 0, y: 0, z: 1 },
      };

      const axisStyle = {
        gridcolor: '#e0e0e0',
        zerolinecolor: '#ccc',
        backgroundcolor: '#fafafa',
      };

      const gridStep = 0.05;
      const numPoints = Math.floor(4 / gridStep) + 1;
      const x1Grid = Array.from({ length: numPoints }, (_, i) => -2 + i * gridStep);
      const x2Grid = Array.from({ length: numPoints }, (_, i) => -2 + i * gridStep);

      let z1Data, z2Data;

      function computeActivation(x1, x2, theta1, theta2, theta0) {
        const linear = theta1 * x1 + theta2 * x2 + theta0;
        if (activationFunction === "sigmoid") {
          return 1 / (1 + Math.exp(-linear));
        } else if (activationFunction === "relu") {
          return Math.max(0, linear);
        }
      }

      function generatez1_2(theta_11, theta_12, theta_10) {
        let z = [];
        for (let i = 0; i < x1Grid.length; i++) {
          let zRow = [];
          for (let j = 0; j < x2Grid.length; j++) {
            zRow.push(computeActivation(x1Grid[i], x2Grid[j], theta_11, theta_12, theta_10));
          }
          z.push(zRow);
        }
        return { z: z };
      }

      function generatez2(theta_21, theta_22, theta_20) {
        let z = [];
        for (let i = 0; i < x1Grid.length; i++) {
          let zRow = [];
          for (let j = 0; j < x2Grid.length; j++) {
            zRow.push(computeActivation(x1Grid[i], x2Grid[j], theta_21, theta_22, theta_20));
          }
          z.push(zRow);
        }
        return { z: z };
      }

      function makeLayout(zTitle, zRange) {
        return {
          margin: { l: 0, r: 0, t: 0, b: 0 },
          paper_bgcolor: '#fafafa',
          scene: {
            xaxis: {
              title: "x\u2081",
              range: [-2, 2],
              tickmode: "array",
              tickvals: [-1, 0, 1],
              ...axisStyle
            },
            yaxis: {
              title: "x\u2082",
              range: [-2, 2],
              tickmode: "array",
              tickvals: [-1, 0, 1],
              ...axisStyle
            },
            zaxis: {
              title: zTitle,
              range: zRange,
              ...axisStyle
            },
            aspectmode: "cube",
            camera: fixedCameraSettings
          }
        };
      }

      function update_layer2() {
        var w1 = parseFloat(document.getElementById("w1").value);
        var w2 = parseFloat(document.getElementById("w2").value);
        var w0 = parseFloat(document.getElementById("w0").value);
        let zWeighted = [];
        let zMin = Infinity, zMax = -Infinity;
        for (let i = 0; i < z1Data.length; i++) {
          let zRow = [];
          for (let j = 0; j < z1Data[i].length; j++) {
            var val = w1 * z1Data[i][j] + w2 * z2Data[i][j] + w0;
            zRow.push(val);
            if (val < zMin) zMin = val;
            if (val > zMax) zMax = val;
          }
          zWeighted.push(zRow);
        }
        // Auto-range with some padding
        var pad = (zMax - zMin) * 0.1 || 1;
        var layout = {
          margin: { l: 0, r: 0, t: 0, b: 0 },
          paper_bgcolor: '#fafafa',
          scene: {
            xaxis: {
              title: "x\u2081",
              range: [-2, 2],
              tickmode: "array",
              tickvals: [-1, 0, 1],
              ...axisStyle
            },
            yaxis: {
              title: "x\u2082",
              range: [-2, 2],
              tickmode: "array",
              tickvals: [-1, 0, 1],
              ...axisStyle
            },
            zaxis: {
              title: "w\u2081a\u2081 + w\u2082a\u2082 + w\u2080",
              range: [zMin - pad, zMax + pad],
              ...axisStyle
            },
            aspectmode: "cube",
            camera: fixedCameraSettings
          }
        };
        Plotly.react("plot_weighted", [{
          x: x1Grid,
          y: x2Grid,
          z: zWeighted,
          type: "surface",
          showscale: false,
          colorscale: demoColorscale
        }], layout);
        document.getElementById("w1_value").textContent = w1;
        document.getElementById("w2_value").textContent = w2;
        document.getElementById("w0_value").textContent = w0;
      }

      function createz1() {
        var theta_11 = parseFloat(document.getElementById("theta_11").value);
        var theta_12 = parseFloat(document.getElementById("theta_12").value);
        var theta_10 = parseFloat(document.getElementById("theta_10").value);
        var data = generatez1_2(theta_11, theta_12, theta_10);
        z1Data = data.z;
        var fname = activationFunction === "sigmoid" ? "\u03c3" : "ReLU";
        var zRange = [0, activationFunction === "sigmoid" ? 1 : 10];
        var layout = makeLayout(
          "a\u2081 = " + fname + "(w\u2081\u2081x\u2081 + w\u2081\u2082x\u2082 + w\u2081\u2080)",
          zRange
        );
        Plotly.newPlot("plot3d", [{
          x: x1Grid, y: x2Grid, z: data.z,
          type: "surface", showscale: false, colorscale: demoColorscale
        }], layout);
      }

      function createz2() {
        var theta_21 = parseFloat(document.getElementById("theta_21").value);
        var theta_22 = parseFloat(document.getElementById("theta_22").value);
        var theta_20 = parseFloat(document.getElementById("theta_20").value);
        var data = generatez2(theta_21, theta_22, theta_20);
        z2Data = data.z;
        var fname = activationFunction === "sigmoid" ? "\u03c3" : "ReLU";
        var zRange = [0, activationFunction === "sigmoid" ? 1 : 10];
        var layout = makeLayout(
          "a\u2082 = " + fname + "(w\u2082\u2081x\u2081 + w\u2082\u2082x\u2082 + w\u2082\u2080)",
          zRange
        );
        Plotly.newPlot("plot3d_2", [{
          x: x1Grid, y: x2Grid, z: data.z,
          type: "surface", showscale: false, colorscale: demoColorscale
        }], layout);
      }

      function updatez1() {
        var theta_11 = parseFloat(document.getElementById("theta_11").value);
        var theta_12 = parseFloat(document.getElementById("theta_12").value);
        var theta_10 = parseFloat(document.getElementById("theta_10").value);
        document.getElementById("theta_11_value").textContent = theta_11;
        document.getElementById("theta_12_value").textContent = theta_12;
        document.getElementById("theta_10_value").textContent = theta_10;
        var data = generatez1_2(theta_11, theta_12, theta_10);
        z1Data = data.z;
        var fname = activationFunction === "sigmoid" ? "\u03c3" : "ReLU";
        var zRange = [0, activationFunction === "sigmoid" ? 1 : 10];
        var layout = makeLayout(
          "a\u2081 = " + fname + "(w\u2081\u2081x\u2081 + w\u2081\u2082x\u2082 + w\u2081\u2080)",
          zRange
        );
        Plotly.react("plot3d", [{
          x: x1Grid, y: x2Grid, z: data.z,
          type: "surface", showscale: false, colorscale: demoColorscale
        }], layout);
        update_layer2();
      }

      function updatez2() {
        var theta_21 = parseFloat(document.getElementById("theta_21").value);
        var theta_22 = parseFloat(document.getElementById("theta_22").value);
        var theta_20 = parseFloat(document.getElementById("theta_20").value);
        document.getElementById("theta_21_value").textContent = theta_21;
        document.getElementById("theta_22_value").textContent = theta_22;
        document.getElementById("theta_20_value").textContent = theta_20;
        var data = generatez2(theta_21, theta_22, theta_20);
        z2Data = data.z;
        var fname = activationFunction === "sigmoid" ? "\u03c3" : "ReLU";
        var zRange = [0, activationFunction === "sigmoid" ? 1 : 10];
        var layout = makeLayout(
          "a\u2082 = " + fname + "(w\u2082\u2081x\u2081 + w\u2082\u2082x\u2082 + w\u2082\u2080)",
          zRange
        );
        Plotly.react("plot3d_2", [{
          x: x1Grid, y: x2Grid, z: data.z,
          type: "surface", showscale: false, colorscale: demoColorscale
        }], layout);
        update_layer2();
      }

      window.onload = function () {
        document.getElementById("theta_11_value").textContent = document.getElementById("theta_11").value;
        document.getElementById("theta_12_value").textContent = document.getElementById("theta_12").value;
        document.getElementById("theta_10_value").textContent = document.getElementById("theta_10").value;
        document.getElementById("theta_21_value").textContent = document.getElementById("theta_21").value;
        document.getElementById("theta_22_value").textContent = document.getElementById("theta_22").value;
        document.getElementById("theta_20_value").textContent = document.getElementById("theta_20").value;
        document.getElementById("w1_value").textContent = document.getElementById("w1").value;
        document.getElementById("w2_value").textContent = document.getElementById("w2").value;
        document.getElementById("w0_value").textContent = document.getElementById("w0").value;
        createz1();
        createz2();
        update_layer2();
      };

      window.addEventListener("resize", function () {
        Plotly.Plots.resize(document.getElementById("plot3d"));
        Plotly.Plots.resize(document.getElementById("plot3d_2"));
        Plotly.Plots.resize(document.getElementById("plot_weighted"));
      });
    </script>
  </body>
</html>
